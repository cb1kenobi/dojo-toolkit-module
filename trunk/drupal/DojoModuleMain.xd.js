/*
	Copyright (c) 2004-2007, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/community/licensing.shtml
*/

/*
	This is a compiled version of Dojo, built for deployment and not for
	development. To get an editable version, please visit:

		http://dojotoolkit.org

	for documentation and information on getting the source.
*/

dojo._xdResourceLoaded({depends:[["provide","drupal.form.AutoComplete"],["provide","drupal.form.Editor"],["provide","drupal.layout.CollapsiblePane"],["provide","drupal.DojoModuleMain"],["require","dojo.fx"],["require","dijit._Widget"],["require","dijit.Editor"],["require","dijit._editor.plugins.AlwaysShowToolbar"],["require","dijit._editor.plugins.EnterKeyHandling"],["require","dijit._editor.plugins.LinkDialog"],["require","dojox.collections.ArrayList"]],defineResource:function(_1){if(!_1._hasResource["drupal.form.AutoComplete"]){_1._hasResource["drupal.form.AutoComplete"]=true;_1.provide("drupal.form.AutoComplete");_1.declare("drupal.form.AutoComplete",dijit._Widget,{url:"",cacheItemsCap:9,_popup:null,_toggler:null,_xhr:null,_anim:null,_selected:null,_cache:[],postCreate:function(){if(this.url[this.url.length-1]!="/"){this.url+="/";}var d=document.createElement("div");d.id="autocomplete";_1.style(d,"display","none");_1.style(d,"opacity",0);_1.place(d,this.domNode,"before");this._popup=d;this._toggler=new _1.fx.Toggler({node:d,hideDuration:300});var n=this.domNode;_1.connect(n,"onkeydown",this,"_onKeyDown");_1.connect(n,"onkeypress",this,"_onKeyPress");_1.connect(n,"onkeyup",this,"_onKeyUp");_1.connect(n,"onblur",this,"_hidePopup");},_onKeyDown:function(_4){if(this._popup){var k=_4.keyCode;if(k==13){_1.stopEvent(_4);this._insert();return false;}else{if(k==9){this._insert();}else{if(k==38||k==40){_1.stopEvent(_4);this._moveSelect(_4,k==38);return false;}}}}return true;},_onKeyPress:function(_6){if(_6.keyCode==13){_1.stopEvent(_6);return false;}return true;},_onKeyUp:function(_7){var k=_7.keyCode;if(k==3||(k>8&&k<32)||(k>32&&k<46)||(k>90&&k<94)||(k>111&&k<146)){_1.stopEvent(_7);if(k==27){this._hidePopup();}return false;}var _9=this.domNode.value;if(_9.length){this._query(_9);}else{this._hidePopup();}return true;},_query:function(_a){this._selected=null;if(this._xhr!=null){this._xhr.cancel();this._xhr=null;}if(this._cache[_a]){this._showPopup(_a);return;}if(_a.length>1){var n=this._cache[_a.substring(0,_a.length-1)];if(n&&n.length<=this.cacheItemsCap){var d=[];for(var i=0;i<n.length;i++){if(n[i].toLowerCase().indexOf(_a.toLowerCase())==0){d.push(n[i]);}}this._cache[_a]=d;this._showPopup(_a);return;}}this._throb(true);var _e=this;this._xhr=_1.xhrGet({url:this.url+escape(_a),handleAs:"json",load:function(_f,_10){var d=[];for(var i in _f){d.push(_f[i]);}_e._cache[_a]=d;_e._showPopup(_a);}});},_showPopup:function(str){this._throb(false);var _14=this._cache[str];if(_14.length==0){this._hidePopup();return;}var _15=_1.style(this._popup,"display")=="none";var d=this._popup;while(d.firstChild){_1._destroyElement(d.firstChild);}var ul=document.createElement("ul");for(var i=0;i<_14.length;i++){var li=document.createElement("li");li.val=_14[i];li.innerHTML=_14[i];ul.appendChild(li);_1.connect(li,"onmousedown",this,"_insert");_1.connect(li,"onmouseover",_1.hitch(this,function(evt){this._highlight(evt.target);}));_1.connect(li,"onmouseout",_1.hitch(this,function(evt){this._unhighlight(evt.target);}));}d.appendChild(ul);this._highlight(_1.query("li",ul)[0]);if(_15){var dim=_1.coords(this.domNode);d.style.marginTop=dim.h+"px";d.style.width=(dim.w-4)+"px";_1.style(d,"display","");this._toggler.show();}},_hidePopup:function(){this._toggler.hide();_1.style(this._popup,"display","none");},_moveSelect:function(evt,up){if(this._popup){if(!this._selected){this._highlight(_1.query("li:first-child",ul)[0]);}else{var lis=_1.query("li",this._selected.parentNode);for(var i=0;i<lis.length;i++){if(lis[i]==this._selected){if(up&&i>0){this._highlight(lis[--i]);}else{if(!up&&i+1<lis.length){this._highlight(lis[++i]);}}break;}}}}},_insert:function(evt){if(evt||this._selected){if(evt){_1.stopEvent(evt);}var n=evt?evt.target:this._selected;this.domNode.value=n.val;this._hidePopup();}},_highlight:function(n){var s=this._selected;if(s&&_1.hasClass(s,"selected")){_1.removeClass(s,"selected");}_1.addClass(n,"selected");this._selected=n;},_unhighlight:function(n){_1.removeClass(n,"selected");this._selected=null;},_throb:function(_26){var n=this.domNode;var b=_1.hasClass(n,"throbbing");if(b&&!_26){_1.removeClass(n,"throbbing");}else{if(!b&&_26){_1.addClass(n,"throbbing");}}}});}if(!_1._hasResource["drupal.form.Editor"]){_1._hasResource["drupal.form.Editor"]=true;_1.provide("drupal.form.Editor");_1.declare("drupal.form.Editor",dijit._Widget,{showToggle:true,defaultState:false,plugins:[],_styleSheets:null,_textareaID:null,_containerTextArea:null,_containerEditor:null,_editor:null,_toggleLink:null,_grip:null,_offset:0,_mouseMove:null,_mouseUp:null,postCreate:function(){var ss=[];for(var i=0,a=null,_2c=_1.query("link");a=_2c[i];i++){var rel=a.getAttribute("rel");if(rel&&rel.indexOf("style")!=-1&&!a.disabled){var h=a.getAttribute("href");if(h&&!ss[h]){ss[h]=h;}}}var _2f=/@import\s*['"]?([\t\s\w-()\/.\\:#=&?]+)/i;var _30=/url\(\s*([\t\s\w()\/.\\'"-:#=&?]+)\s*\)/i;for(var i=0,a=null,_2c=_1.query("style");a=_2c[i];i++){var _31=a.getAttribute("type");var _32=a.getAttribute("media");if(_31&&_31.toLowerCase()=="text/css"&&(!_32||_32.toLowerCase()!="print")&&!a.disabled&&a.innerHTML.indexOf("@import")!=-1){var _33=_2f.exec(a.innerHTML);if(_33&&_33.length>1){var str=_33[1].replace(/(^\s*|\s*$)/g,"");_33=_30.exec(str);if(_33&&_33.length>1){str=_33[1].replace(/(^\s*|\s*$)/g,"");}if(!ss[str]){ss[str]=str;}}}}var _35=location.protocol+"//"+location.host;this._styleSheets=[];for(var k in ss){this._styleSheets.push((k.toLowerCase().indexOf("http")!=-1?"":_35)+k);}this._textareaID=this.domNode.id;var cta=document.createElement("div");cta.className="resizable-textarea";_1.place(cta,this.domNode,"after");cta.appendChild(this.domNode);this._containerTextArea=cta;var _38=document.createElement("div");_38.className="grippie";cta.appendChild(_38);_1.connect(_38,"onmousedown",this,"_startDrag");var ce=document.createElement("div");ce.className="dijitEditor";_1.place(ce,cta,"after");_1.style(ce,"display","none");this._containerEditor=ce;if(this.showToggle){var a=document.createElement("a");a.href="#";a.innerHTML="Enable rich text editor";_1.connect(a,"onclick",this,"_toggleEditor");this._toggleLink=a;var d=document.createElement("div");d.appendChild(a);_1.place(d,ce,"after");}if(this.defaultState){this._toggleEditor();}},_toggleEditor:function(evt){if(evt){_1.stopEvent(evt);}if(this._editor){this._onEditorBlur();this._editor.destroy();this._editor=null;_1.style(this._containerTextArea,"display","");_1.style(this._containerEditor,"display","none");this._setToggleLink("Enable rich text editor");}else{this._containerEditor.innerHTML=this.domNode.value;_1.style(this._containerTextArea,"display","none");_1.style(this._containerEditor,"display","");var a=function(txt){return txt.replace(/\n/g,"<br/>");};var b=function(txt){return txt.replace(/\<br\s*\/?\>/ig,"\n");};this._editor=new dijit.Editor({toolbarAlwaysVisible:true,focusOnLoad:true,minHeight:"15em",height:"",plugins:this.plugins,extraPlugins:["dijit._editor.plugins.AlwaysShowToolbar"],editingAreaStyleSheets:this._styleSheets,contentPreFilters:[a],contentPostFilters:[b]},this._containerEditor);_1.query("html",this._editor.document)[0].className="dijitEditorInner";_1.connect(this._editor,"onBlur",this,"_onEditorBlur");setTimeout(_1.hitch(this,function(){this._editor.onClick();}),1000);this._setToggleLink("Disable rich text editor");}},_onEditorBlur:function(){var s=_1.isFunction(this._editor.getValue)?this._editor.getValue():this._editor.getEditorContent();this.domNode.value=s.replace(/contenteditable="true"/ig,"");},_setToggleLink:function(str){if(this._toggleLink){this._toggleLink.innerHTML=str;}},_startDrag:function(evt){_1.stopEvent(evt);this._offset=_1.coords(this.domNode).h-evt.pageY;_1.style(this.domNode,"opacity",0.25);this._mouseMove=_1.connect(document,"onmousemove",this,"_onDrag");this._mouseUp=_1.connect(document,"onmouseup",this,"_endDrag");},_onDrag:function(evt){this.domNode.style.height=Math.max(32,this._offset+evt.pageY)+"px";},_endDrag:function(){_1.disconnect(this._mouseMove);_1.disconnect(this._mouseUp);_1.style(this.domNode,"opacity",1);}});}if(!_1._hasResource["drupal.layout.CollapsiblePane"]){_1._hasResource["drupal.layout.CollapsiblePane"]=true;_1.provide("drupal.layout.CollapsiblePane");_1.declare("drupal.layout.CollapsiblePane",dijit._Widget,{_wrapper:null,_animating:false,postCreate:function(){var _44=_1.query("legend",this.domNode)[0];var a=document.createElement("a");a.href="#";a.innerHTML=_44.innerHTML;_1.connect(a,"onclick",_1.hitch(this,function(evt){_1.stopEvent(evt);if(!this._animating){this._animating=true;this._toggleFieldset();}}));while(_44.firstChild){_1._destroyElement(_44.firstChild);}_44.appendChild(a);var d=document.createElement("div");d.className="fieldset-wrapper";_1.style(d,"display",_1.hasClass(this.domNode,"collapsed")?"none":"");var _48=this.domNode.childNodes;for(var j=0;j<_48.length;j++){if(_48[j].nodeType!=1||!/legend/i.test(_48[j].nodeName)){d.appendChild(_48[j--]);}}this.domNode.appendChild(d);this._wrapper=d;},_toggleFieldset:function(){var n=this.domNode;if(_1.hasClass(n,"collapsed")){n.className=n.className.replace(/ collapsed/i,"");var _4b=_1.fx.wipeIn({node:this._wrapper,duration:300});_1.connect(_4b,"onEnd",_1.hitch(this,function(){this._wrapper.style.height="auto";this._scrollIntoView();this._animating=false;}));_1.connect(_4b,"onAnimate",this,"_scrollIntoView");_4b.play();}else{var _4b=_1.fx.wipeOut({node:this._wrapper,duration:300});_1.connect(_4b,"onEnd",_1.hitch(this,function(){n.className+=" collapsed";this._animating=false;}));_4b.play();}},_scrollIntoView:function(){var n=this.domNode;var vh=dijit.getViewport().height;var c=_1.coords(n,true);var ny=c.y;var nh=c.height;if(ny+nh+55>vh+_1._docScroll().top){window.scrollTo(0,(nh>vh?ny:ny+nh-vh+55));}}});}if(!_1._hasResource["drupal.DojoModuleMain"]){_1._hasResource["drupal.DojoModuleMain"]=true;_1.provide("drupal.DojoModuleMain");}}});
